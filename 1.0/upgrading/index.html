




<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="description" content="Guide to upgrading to newer versions of this library">
    
    <meta name="docsearch:version" content="1.0">
    
        <title>Upgrading from 0.19 to 1.0 - CommonMark for PHP</title>
    
    <link rel="icon" type="image/x-icon" href="//theme.thephpleague.com/img/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="//theme.thephpleague.com/img/apple-touch-icon-precomposed.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@thephpleague" />
    <meta name="twitter:creator" content="@colinodell" />
    <meta property="og:url" content="https://commonmark.thephpleague.com/1.0/upgrading/" />
    
        <meta property="og:title" content="Upgrading from 0.19 to 1.0 - CommonMark for PHP" />
    
    
        <meta property="og:description" content="Guide to upgrading to newer versions of this library" />
    
    <meta property="og:image" content="https://commonmark.thephpleague.com/images/commonmark-social.png" />
    <link rel="stylesheet" href="//theme.thephpleague.com/css/all.css?31f91fcbc2e49e8a1d9ed776d72d6de7457566f5">
    <link rel="stylesheet" href="/custom.css?31f91fcbc2e49e8a1d9ed776d72d6de7457566f5">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <link rel="stylesheet" href="/support.css?31f91fcbc2e49e8a1d9ed776d72d6de7457566f5">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137970568-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-137970568-1');
    </script>
</head>
<body>
<header>
    <div class="header-content">
        <h1 class="title">
            <a class="logo" href="/">
            <span class="name">
                <em>League\</em>CommonMark
            </span>
            </a>
        </h1>
        <div class="search"><input type="search" id="doc-search" placeholder="search the docs..."></div>
        <nav class="versions">
            <h2>v1.0 &#9662;</h2>
            <ul>
            
                <li ><a href="/2.0/">v2.0</a></li>
            
                <li ><a href="/1.4/">v1.4</a></li>
            
                <li ><a href="/1.3/">v1.3</a></li>
            
                <li class="selected"><a href="/1.0/">v1.0</a></li>
            
                <li ><a href="/0.19/">v0.19</a></li>
            
                <li ><a href="/releases/">Notes</a></li>
            </ul>
        </nav>
    </div>
</header>

<input type="checkbox" id="menu">
<label for="menu" onclick>
    <div class="closed">&#9776;</div>
    <div class="open">&#10799;</div>
</label>

<main>
    <menu>
        <div class="versions-small">
        <h2>Versions</h2>
            <ul>
        
                <li >
                    <a href="/2.0/">2.0</a>
                </li>
        
                <li >
                    <a href="/1.4/">1.4</a>
                </li>
        
                <li >
                    <a href="/1.3/">1.3</a>
                </li>
        
                <li class="selected">
                    <a href="/1.0/">1.0</a>
                </li>
        
                <li >
                    <a href="/0.19/">0.19</a>
                </li>
        
                <li ><a href="/releases/">Releases Notes</a></li>
            </ul>
        </div>

        
            
            <div class="menu-section">
                <h2>Getting Started</h2>
                <ul>
                    
                        <li >
                            <a href="/1.0/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/installation/">Installation</a>
                        </li>
                    
                        <li class="selected">
                            <a href="/1.0/upgrading/">Upgrading from 0.19</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/changelog/">Changelog</a>
                        </li>
                    
                </ul>
            </div>
            
            <div class="menu-section">
                <h2>Usage</h2>
                <ul>
                    
                        <li >
                            <a href="/1.0/basic-usage/">Basic Usage</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/configuration/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/security/">Security</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/command-line/">Command Line</a>
                        </li>
                    
                </ul>
            </div>
            
            <div class="menu-section">
                <h2>Customization</h2>
                <ul>
                    
                        <li >
                            <a href="/1.0/customization/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/environment/">Environment</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/extensions/">Extensions</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/event-dispatcher/">Event Dispatcher</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/cursor/">Cursor</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/block-parsing/">Block Parsing</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/inline-parsing/">Inline Parsing</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/delimiter-processing/">Delimiter Processing</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/abstract-syntax-tree/">Abstract Syntax Tree</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/block-rendering/">Block Rendering</a>
                        </li>
                    
                        <li >
                            <a href="/1.0/customization/inline-rendering/">Inline Rendering</a>
                        </li>
                    
                </ul>
            </div>
            
        
    </menu>
    <article>
    

    
        <p class="message-notice">This is the documentation for <code>version 1.0</code>. Please consider upgrading your code to <a href="/1.4/">the latest stable version</a></p>
    

    

        <h1 id="upgrading-from-019-to-10">Upgrading from 0.19 to 1.0</h1>

<h2 id="previous-deprecations-removed">Previous Deprecations Removed</h2>

<p>All previously-deprecated code has been removed. This includes:</p>

<ul>
  <li>The <code class="highlighter-rouge">safe</code> option (use <code class="highlighter-rouge">html_input</code> and <code class="highlighter-rouge">allow_unsafe_links</code> options instead)</li>
  <li>All deprecated <code class="highlighter-rouge">RegexHelper</code> constants</li>
  <li><code class="highlighter-rouge">DocParser::getEnvironment()</code> (you should obtain it some other way)</li>
  <li><code class="highlighter-rouge">AbstractInlineContainer</code> (use <code class="highlighter-rouge">AbstractInline</code> instead and make <code class="highlighter-rouge">isContainer()</code> return <code class="highlighter-rouge">true</code>)</li>
</ul>

<h2 id="document-processors-removed">Document Processors Removed</h2>

<p>We no longer support Document Processors because we now have <a href="/1.0/customization/event-dispatcher/">event dispatching</a> which can fill that same role!  Simply remove the interface from your processor and register it as a listener; for example, instead of this:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyDocumentProcessor</span> <span class="k">implements</span> <span class="nx">DocumentProcessorInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">processDocument</span><span class="p">(</span><span class="nx">Document</span> <span class="nv">$document</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// TODO: Do things with the $document</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="nv">$processor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyDocumentProcessor</span><span class="p">();</span>
<span class="nv">$environment</span><span class="o">-&gt;</span><span class="na">addDocumentProcessor</span><span class="p">(</span><span class="nv">$processor</span><span class="p">);</span>
</code></pre></div></div>

<p>Simply do this:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyDocumentProcessor</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">onDocumentParsed</span><span class="p">(</span><span class="nx">DocumentParsedEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getDocument</span><span class="p">();</span>
        <span class="c1">// TODO: Do things with the $document</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="nv">$processor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyDocumentProcessor</span><span class="p">();</span>
<span class="nv">$environment</span><span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="nx">DocumentParsedEvent</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span><span class="nv">$processor</span><span class="p">,</span> <span class="s1">'onDocumentParsed'</span><span class="p">]);</span>
</code></pre></div></div>

<h2 id="text-encoding">Text Encoding</h2>

<p>This library used to claim it supported ISO-8859-1 encoding but that never truly worked - everything assumed the text was encoded as UTF-8 or ASCII. We’ve therefore dropped support for ISO-8859-1 and any other unexpected encodings. If you were using some other encoding, you’ll now need to convert your Markdown to UTF-8 prior to running it through this library.</p>

<p>Additionally, all public <code class="highlighter-rouge">getEncoding()</code> or <code class="highlighter-rouge">setEncoding()</code> methods have been removed, so assume that you’re working with UTF-8.</p>

<h2 id="inline-processors">Inline Processors</h2>

<p>The “inline processor” functionality has been removed and replaced with a proper “delimiter processor” feature geared specifically towards dealing with delimiters (which is what the previous implementation tried to do - poorly).</p>

<p>No direct upgrade path exists as this implementation was not widely used, or only used for implementing delimiter processing.  If you fall in the latter category, simply leverage the new functionality instead.  Otherwise, if you have another good use case for inline processors, please let us know in the issue tracker.</p>

<h2 id="delimiters">Delimiters</h2>

<p>Now that we have proper delimiter handling, we’ve <code class="highlighter-rouge">final</code>ized the <code class="highlighter-rouge">Delimiter</code> class and extracted a <code class="highlighter-rouge">DelimiterInterface</code> from it.  If you previous extended from <code class="highlighter-rouge">Delimiter</code> you’ll need to implement this new interface instead.</p>

<p>We also deleted these unused <code class="highlighter-rouge">Delimiter</code> methods:</p>

<ul>
  <li><code class="highlighter-rouge">setCanOpen()</code></li>
  <li><code class="highlighter-rouge">setCanClose()</code></li>
  <li><code class="highlighter-rouge">setChar()</code></li>
  <li><code class="highlighter-rouge">setIndex()</code></li>
  <li><code class="highlighter-rouge">setInlineNode()</code></li>
</ul>

<p>And all of the remaining <code class="highlighter-rouge">Delimiter::set___()</code> methods no longer return <code class="highlighter-rouge">$this</code>.</p>

<h2 id="docparser"><code class="highlighter-rouge">DocParser</code></h2>

<p>The <code class="highlighter-rouge">DocParser</code> class is now <code class="highlighter-rouge">final</code> as it was never intended to be extended, especially given how so much logic was in <code class="highlighter-rouge">private</code> methods.  Any custom implementations should implement the new <code class="highlighter-rouge">DocParserInterface</code> interface instead.</p>

<p>Additionally, the <code class="highlighter-rouge">getEnvironment()</code> method has been deprecated and excluded from that new interface, as it was only used internally by the <code class="highlighter-rouge">DocParser</code> and other better ways exist to obtain an environment where needed.</p>

<h2 id="configuration"><code class="highlighter-rouge">Configuration</code></h2>

<p>The <code class="highlighter-rouge">Configuration</code> class is now <code class="highlighter-rouge">final</code> and implements a new <code class="highlighter-rouge">ConfigurationInterface</code>.  If any of your parsers/renders/etc implement <code class="highlighter-rouge">ConfigurationAwareInterface</code> you’ll need to update that method to accept the new interface instead of the concrete class.</p>

<p>We also renamed/added the following methods:</p>

<table>
  <thead>
    <tr>
      <th>Old Name</th>
      <th>New Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">getConfig()</code></td>
      <td><code class="highlighter-rouge">get()</code></td>
    </tr>
    <tr>
      <td><em>n/a</em></td>
      <td><code class="highlighter-rouge">set()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">setConfig()</code></td>
      <td><code class="highlighter-rouge">replace()</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">mergeConfig()</code></td>
      <td><code class="highlighter-rouge">merge()</code></td>
    </tr>
  </tbody>
</table>

<h2 id="abstractinlinecontainer"><code class="highlighter-rouge">AbstractInlineContainer</code></h2>

<p>The <code class="highlighter-rouge">AbstractInlineContainer</code> class added an unnecessary level of inheritance and was therefore deprecated. If you previously extended this class, you should now extend from <code class="highlighter-rouge">AbstractInline</code> and override <code class="highlighter-rouge">isContainer()</code> to return <code class="highlighter-rouge">true</code>.</p>

<h2 id="adjoiningtextcollapser"><code class="highlighter-rouge">AdjoiningTextCollapser</code></h2>

<p>The <code class="highlighter-rouge">AdjoiningTextCollapser</code> is an internal class used to combine multiple <code class="highlighter-rouge">Text</code> elements into one.  If you were using this yourself (unlikely) you’ll need to refer to its new name instead: <code class="highlighter-rouge">AdjacentTextMerger</code>. And if you previously used <code class="highlighter-rouge">collapseTextNodes()</code> you’ll want to switch to using <code class="highlighter-rouge">mergeChildNodes()</code> instead.</p>

<h2 id="references">References</h2>

<p>The <code class="highlighter-rouge">ReferenceParser</code> was moved into the <code class="highlighter-rouge">Reference</code> sub-namespace, so update your imports accordingly.</p>

<p>Virtually all usages of <code class="highlighter-rouge">ReferenceMap</code> in type hints have been replaced with the new <code class="highlighter-rouge">ReferenceMapInterface</code>.  This interface has the same methods, with one small change: <code class="highlighter-rouge">addReference()</code> no longer returns <code class="highlighter-rouge">$this</code>.</p>

    </article>

    <aside class="support-banner-wrapper" x-data="{ show: false }" x-show.transition="show" x-init="h = localStorage.getItem('hideBanner'); (h === null || h < (new Date().getTime())) ? (setTimeout(() => show = true, 500)) : (show = false)" style="">
        <div class="support-banner">
            <p class="support-banner-left">
                <strong>Love PHP Commonmark?</strong>
                <span class="hidden sm:inline-block lg:hidden">
                    Show your support!
                </span>

                <span class="hidden lg:inline-block">
                    Support development via monthly sponsorship or a one-time donation!
                </span>
            </p>

            <div class="support-banner-right">
                <a href="https://www.colinodell.com/sponsor" class="support-button support-button-sponsor">
                    <i class="fas fa-heart fa-fw"></i> Sponsor
                </a>

                <a href="https://www.paypal.me/colinpodell/10.00" class="support-button support-button-donate">
                    <i class="fas fa-donate fa-fw"></i> Donate
                </a>
            </div>

            <button x-on:click="localStorage.setItem('hideBanner', new Date().getTime() + (7*24*60*60*1000)); show = false" class="support-banner-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </aside>
</main>

<footer>
    <span>&copy; Copyright <a href="https://www.colinodell.com">Colin O'Dell</a> &amp; <a href="//thephpleague.com">The League of Extraordinary Packages</a>.</span>
    <span>Site design by <a href="//reinink.ca">Jonathan Reinink</a> and <a href="//nyamsprod.com">Ignace Nyamagana Butera</a>.</span>
</footer>
<script src="/custom.js?31f91fcbc2e49e8a1d9ed776d72d6de7457566f5"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
<script> docsearch({
    apiKey: '8f6d6eb939fe0df83616a0bb240332c8',
    indexName: 'commonmark-thephpleague',
    inputSelector: '#doc-search',
    algoliaOptions: { 'facetFilters': ["version:1.0"] },
    debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>
